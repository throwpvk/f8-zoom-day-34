<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product List</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 30px;
      }

      body {
        background: linear-gradient(to right, #faffd1, #a1ffce);
      }

      #root {
        width: 100%;
        max-width: 900px;
        padding: 0 15px;
      }
      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }
      .spinner {
        width: 50px;
        height: 50px;
        border: 6px solid #ccc;
        border-top-color: cadetblue;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .card h3 {
        margin: 0;
        color: cadetblue;
      }
      .card span {
        color: #333;
        font-size: 0.9rem;
      }
      .card button {
        margin-top: auto;
        background: cadetblue;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px;
        cursor: pointer;
        transition: 0.2s;
      }
      .card button:hover {
        background: darkcyan;
      }

      /* Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.4);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }
      .modal.show {
        opacity: 1;
        pointer-events: all;
      }
      .modal-content {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        display: flex;
        flex-direction: column;
        gap: 10px;
        animation: scaleIn 0.3s ease forwards;
      }
      @keyframes scaleIn {
        0% {
          transform: scale(0.8);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      .modal-content button {
        align-self: flex-end;
        background: cadetblue;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 12px;
        cursor: pointer;
      }
      .modal-content button:hover {
        background: darkcyan;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
      const { useState, useEffect } = React;

      const Loading = () => (
        <div className="loading">
          <div className="spinner"></div>
          <span>Đang tải...</span>
        </div>
      );

      const Modal = ({ visible, onClose, children }) => {
        const handleOverlayClick = (e) => {
          if (e.target === e.currentTarget) onClose();
        };
        if (!visible) return null;
        return (
          <div className={`modal show`} onClick={handleOverlayClick}>
            <div className="modal-content">
              {children}
              <button onClick={onClose}>Close</button>
            </div>
          </div>
        );
      };

      const ProductCard = ({ post, onDetail }) => {
        const truncate = (str, n = 100) =>
          str.length > n ? str.slice(0, n) + "…" : str;
        const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);
        return (
          <div className="card">
            <h3>{capitalize(post.title)}</h3>
            <span>{truncate(post.body)}</span>
            <button onClick={() => onDetail(post)}>Show detail</button>
          </div>
        );
      };

      const App = () => {
        // Quản lý loading
        const [loading, setLoading] = useState(true);
        // Quản lý trạng thái modal
        const [modalVisible, setModalVisible] = useState(false);
        // Quản lý danh sách post
        const [posts, setPosts] = useState([]);
        // Quản lý trạng thái post mà mình đã chọn, chưa chọn thì null
        const [selectedPost, setSelectedPost] = useState(null);

        useEffect(() => {
          fetch("https://jsonplaceholder.typicode.com/posts?_limit=12")
            .then((res) => res.json())
            .then((data) => {
              // Lấy dữ liệu lưu vào posts
              setPosts(data);
              // Tắt loading
              setLoading(false);
            })
            .catch((err) => {
              console.error(err);
              // Tắt loading
              setLoading(false);
            });
        }, []);

        // Hàm xử lý khi nhấn nút xem chi tiết
        const handleDetail = (post) => {
          // Lấy post hiện tại gán cho post đã chọn
          setSelectedPost(post);
          // Hiển thị modal hiển thị chi tiết post đã chọn
          setModalVisible(true);
        };

        // Hàm ẩn modal
        const handleCloseModal = () => {
          // Ẩn modal
          setModalVisible(false);
          // Reset post đã chọn về null
          setSelectedPost(null);
        };

        return (
          <>
            {loading && <Loading />}{" "}
            {/* nếu có loading thì mới hiển thị, không thì tắt*/}
            {!loading && (
              <div className="grid">
                {posts.map((post) => (
                  <ProductCard
                    key={post.id}
                    post={post}
                    onDetail={handleDetail}
                  />
                ))}
              </div>
            )}
            <Modal visible={modalVisible} onClose={handleCloseModal}>
              {selectedPost && (
                <>
                  <h3>{selectedPost.title}</h3>
                  <span>{selectedPost.body}</span>
                </>
              )}
            </Modal>
          </>
        );
      };

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
