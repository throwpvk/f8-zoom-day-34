<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather App</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(to right, #faffd1, #a1ffce);
      }
      #root {
        width: 100%;
        max-width: 1200px;
        margin: 20px auto;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(2, auto);
        gap: 20px;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      .card h2 {
        margin: 0 0 10px;
        color: cadetblue;
      }
      select,
      button {
        padding: 6px 10px;
        border-radius: 6px;
        margin: 5px 0;
        border: none;
      }
      select {
        background: #f3f3f3;
      }
      button {
        background: cadetblue;
        color: white;
        cursor: pointer;
        transition: 0.2s;
      }
      button:hover {
        background: darkcyan;
      }
      .emoji {
        font-size: 2.5rem;
      }
      .info {
        font-size: 1rem;
        margin: 5px 0;
      }
      @media (max-width: 900px) {
        #root {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 600px) {
        #root {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
      const { useState } = React;
      // Th·ªùi ti·∫øt
      const weatherTypes = [
        { weather: "N·∫Øng", icon: "‚òÄÔ∏è" },
        { weather: "N·∫Øng g·∫Øt", icon: "üåû" },
        { weather: "N·∫Øng d·ªãu", icon: "üåÖ" },
        { weather: "N·∫Øng n√≥ng k·ª∑ l·ª•c", icon: "üî•" },

        { weather: "C√≥ m√¢y", icon: "üå§Ô∏è" },
        { weather: "Nhi·ªÅu m√¢y", icon: "‚òÅÔ∏è" },
        { weather: "M√¢y r·∫£i r√°c", icon: "‚õÖ" },
        { weather: "Tr·ªùi u √°m", icon: "üå•Ô∏è" },

        { weather: "M∆∞a nh·∫π", icon: "üå¶Ô∏è" },
        { weather: "M∆∞a v·ª´a", icon: "üåßÔ∏è" },
        { weather: "M∆∞a to", icon: "üå®Ô∏è" },
        { weather: "M∆∞a ph√πn", icon: "üíß" },
        { weather: "M∆∞a r√†o", icon: "üå¶Ô∏è" },
        { weather: "M∆∞a ƒë√°", icon: "üßä" },

        { weather: "Gi√¥ng b√£o", icon: "‚õàÔ∏è" },
        { weather: "S·∫•m s√©t", icon: "‚ö°" },
        { weather: "B√£o nhi·ªát ƒë·ªõi", icon: "üåÄ" },
        { weather: "L·ªëc xo√°y", icon: "üå™Ô∏è" },

        { weather: "Tuy·∫øt", icon: "‚ùÑÔ∏è" },
        { weather: "Tuy·∫øt r∆°i nh·∫π", icon: "üå®Ô∏è" },
        { weather: "B√£o tuy·∫øt", icon: "üå¨Ô∏è" },
        { weather: "S∆∞∆°ng gi√°", icon: "ü•∂" },
      ];

      // Danh s√°ch t·ªânh th√†nh ph√¢n chia theo khu v·ª±c
      const regions = {
        "ƒê·ªìng b·∫±ng s√¥ng H·ªìng": [
          "H√† N·ªôi",
          "Vƒ©nh Ph√∫c",
          "B·∫Øc Ninh",
          "Qu·∫£ng Ninh",
          "H·∫£i D∆∞∆°ng",
          "H·∫£i Ph√≤ng",
          "H∆∞ng Y√™n",
          "Th√°i B√¨nh",
          "H√† Nam",
          "Nam ƒê·ªãnh",
          "Ninh B√¨nh",
        ],
        "Trung du mi·ªÅn n√∫i ph√≠a B·∫Øc": [
          "H√† Giang",
          "Cao B·∫±ng",
          "B·∫Øc K·∫°n",
          "Tuy√™n Quang",
          "L√†o Cai",
          "Y√™n B√°i",
          "Th√°i Nguy√™n",
          "L·∫°ng S∆°n",
          "B·∫Øc Giang",
          "Ph√∫ Th·ªç",
          "ƒêi·ªán Bi√™n",
          "Lai Ch√¢u",
          "S∆°n La",
          "Ho√† B√¨nh",
        ],
        "Mi·ªÅn Trung": [
          "Thanh Ho√°",
          "Ngh·ªá An",
          "H√† Tƒ©nh",
          "Qu·∫£ng B√¨nh",
          "Qu·∫£ng Tr·ªã",
          "Th·ª´a Thi√™n Hu·∫ø",
          "ƒê√† N·∫µng",
          "Qu·∫£ng Nam",
          "Qu·∫£ng Ng√£i",
          "B√¨nh ƒê·ªãnh",
          "Ph√∫ Y√™n",
          "Kh√°nh Ho√†",
          "Ninh Thu·∫≠n",
          "B√¨nh Thu·∫≠n",
        ],
        "T√¢y Nguy√™n": ["Kon Tum", "Gia Lai", "ƒê·∫Øk L·∫Øk", "ƒê·∫Øk N√¥ng", "L√¢m ƒê·ªìng"],
        "ƒê√¥ng Nam B·ªô": [
          "B√¨nh Ph∆∞·ªõc",
          "T√¢y Ninh",
          "B√¨nh D∆∞∆°ng",
          "ƒê·ªìng Nai",
          "B√† R·ªãa - V≈©ng T√†u",
          "TP.HCM",
        ],
        "ƒê·ªìng b·∫±ng s√¥ng C·ª≠u Long": [
          "Long An",
          "Ti·ªÅn Giang",
          "B·∫øn Tre",
          "Tr√† Vinh",
          "Vƒ©nh Long",
          "ƒê·ªìng Th√°p",
          "An Giang",
          "Ki√™n Giang",
          "C·∫ßn Th∆°",
          "H·∫≠u Giang",
          "S√≥c TrƒÉng",
          "B·∫°c Li√™u",
          "C√† Mau",
        ],
      };
      // M·∫£ng ch·ª©a t·∫•t c·∫£ t·ªânh th√†nh
      const allCities = [].concat(...Object.values(regions));
      // Kh·ªüi t·∫°o obj d·ªØ li·ªáu th·ªùi ti·∫øt
      const weatherDataInit = {};
      // G√°n gi√° tr·ªã cho obj th·ªùi ti·∫øt
      allCities.forEach((city) => {
        // T·∫°o gi√° tr·ªã th·ªùi ti·∫øt ng·∫´u nhi√™n
        const randomType =
          weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
        weatherDataInit[city] = {
          city,
          // T·∫°o nhi·ªát ƒë·ªô ng·∫´u nhi√™n
          temp: Math.floor(Math.random() * 35) + 5,
          // T·∫°o ƒë·ªô ·∫©m ng·∫´u nhi√™n
          humidity: Math.floor(Math.random() * 101),
          // Th√¥ng tin th·ªùi ti·∫øt
          weather: randomType.weather,
          // icon th·ªùi ti·∫øt
          icon: randomType.icon,
        };
      });
      // H√†m l·∫•y gi√° tr·ªã th·ªùi ti·∫øt xu·∫•t hi·ªán nhi·ªÅu nh·∫•t trong khu v·ª±c
      const mostFrequentWeather = (cities, data) => {
        const count = {};
        // ƒê·∫øm t·ª´ng gi√° tr·ªã th·ªùi ti·∫øt
        cities.forEach((city) => {
          const w = data[city].weather;
          count[w] = (count[w] || 0) + 1;
        });
        // L·∫•y s·ªë l·∫ßn xu·∫•t hi·ªán nhi·ªÅu nh·∫•t c·ªßa th·ªùi ti·∫øt
        const maxCount = Math.max(...Object.values(count));
        // L·ªçc l·∫•y gi√° tr·ªã th·ªùi ti·∫øt xu·∫•t hi·ªán nhi·ªÅu nh·∫•t
        const candidates = Object.keys(count).filter(
          (k) => count[k] === maxCount
        );
        // N·∫øu c√≥ nhi·ªÅu th·ªùi ti·∫øt c√≥ c√πng b·∫±ng max, th√¨ ch·ªçn ng·∫´u nhi√™n
        const chosen =
          candidates[Math.floor(Math.random() * candidates.length)];

        const icon = data[cities.find((c) => data[c].weather === chosen)].icon;
        return { icon, weather: chosen };
      };

      const RegionCard = ({
        regionName,
        cities,
        weatherData,
        setWeatherData,
      }) => {
        const [selectedCity, setSelectedCity] = useState("all");
        // H√†m x·ª≠ l√Ω thay ƒë·ªïi t·ªânh th√†nh khi select
        const handleChange = (e) => setSelectedCity(e.target.value);
        // H√†m l√†m m·ªõi khi nh·∫•n n√∫t l√†m m·ªõi
        const handleRefresh = () => {
          // N·∫øu ƒëang l√† to√†n khu v·ª±c th√¨ l√†m m·ªõi ng·∫´u nhi√™n 1 t·ªânh trong khu v·ª±c
          const city =
            selectedCity === "all"
              ? cities[Math.floor(Math.random() * cities.length)]
              : selectedCity;
          // C·∫≠p nh·∫≠t d·ªØ li·ªáu th·ªùi ti·∫øt
          setWeatherData((prev) => {
            // Copy l·∫°i d·ªØ li·ªáu
            const newData = { ...prev };
            // T·∫°o d·ªØ li·ªáu ng·∫´u nhi√™n
            const randomType =
              weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
            // G√°n gi√° tr·ªã ng·∫´u nhi√™n ƒë√£ t·∫°o v√†o th√†nh ph·ªë ƒë√£ ch·ªçn
            newData[city] = {
              ...newData[city],
              temp: Math.floor(Math.random() * 35) + 5,
              humidity: Math.floor(Math.random() * 101),
              weather: randomType.weather,
              icon: randomType.icon,
            };
            // Tr·∫£ v·ªÅ danh s√°ch m·ªõi, v·ªõi 1 th√†nh ph·ªë ƒë√£ ƒë∆∞·ª£c l√†m m·ªõi
            return newData;
          });
        };
        // L·∫´y d·ªØ li·ªáu th·ªùi ti·∫øt xu·∫•t hi·ªán nhi·ªÅu nh·∫•t trong khu v·ª±c
        const { icon, weather } = mostFrequentWeather(cities, weatherData);
        // D·ªØ li·ªáu ƒë∆∞·ª£c hi·ªÉn th·ªã
        const displayData =
          selectedCity === "all"
            ? {
                // Nhi·ªát ƒë·ªô l√† trung b√¨nh c·ªßa c√°c t·ªânh trong khu v·ª±c
                temp: Math.round(
                  cities.reduce((sum, c) => sum + weatherData[c].temp, 0) /
                    cities.length
                ),
                // ƒêi·ªã ·∫©m l√† trung b√¨nh c·ªßa c√°c t·ªânh trong khu v·ª±c
                humidity: Math.round(
                  cities.reduce((sum, c) => sum + weatherData[c].humidity, 0) /
                    cities.length
                ),
                // Th√¥ng tin th·ªùi ti·∫øt l√† th·ªùi ti·∫øt xu·∫•t hi·ªán nhi·ªÅu nh·∫•t trong khu v·ª±c
                icon,
                weather,
              }
            : weatherData[selectedCity];

        return (
          <div className="card">
            <h2>{regionName}</h2>
            <select value={selectedCity} onChange={handleChange}>
              <option value="all">To√†n khu v·ª±c</option>
              {cities.map((city) => (
                <option key={city} value={city}>
                  {city}
                </option>
              ))}
            </select>
            <div className="emoji">{displayData.icon}</div>
            <div className="info">
              <strong>
                {selectedCity === "all" ? "To√†n khu v·ª±c" : displayData.city}
              </strong>
            </div>
            <div>Nhi·ªát ƒë·ªô: {displayData.temp}¬∞C</div>
            <div>ƒê·ªô ·∫©m: {displayData.humidity}%</div>
            <div>Th·ªùi ti·∫øt: {displayData.weather}</div>
            <button onClick={handleRefresh}>L√†m m·ªõi</button>
          </div>
        );
      };

      const App = () => {
        const [weatherData, setWeatherData] = useState(weatherDataInit);
        return (
          <>
            {Object.keys(regions).map((region) => (
              <RegionCard
                key={region}
                regionName={region}
                cities={regions[region]}
                weatherData={weatherData}
                setWeatherData={setWeatherData}
              />
            ))}
          </>
        );
      };

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
