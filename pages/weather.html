<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather App</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(to right, #faffd1, #a1ffce);
      }
      #root {
        width: 100%;
        max-width: 1200px;
        margin: 20px auto;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(2, auto);
        gap: 20px;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      .card h2 {
        margin: 0 0 10px;
        color: cadetblue;
      }
      select,
      button {
        padding: 6px 10px;
        border-radius: 6px;
        margin: 5px 0;
        border: none;
      }
      select {
        background: #f3f3f3;
      }
      button {
        background: cadetblue;
        color: white;
        cursor: pointer;
        transition: 0.2s;
      }
      button:hover {
        background: darkcyan;
      }
      .emoji {
        font-size: 2.5rem;
      }
      .info {
        font-size: 1rem;
        margin: 5px 0;
      }
      @media (max-width: 900px) {
        #root {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 600px) {
        #root {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
      const { useState } = React;

      const weatherTypes = [
        { weather: "N·∫Øng", icon: "‚òÄÔ∏è" },
        { weather: "C√≥ m√¢y", icon: "üå§Ô∏è" },
        { weather: "M∆∞a nh·∫π", icon: "üåßÔ∏è" },
        { weather: "Gi√¥ng b√£o", icon: "‚õàÔ∏è" },
        { weather: "Tuy·∫øt", icon: "‚ùÑÔ∏è" },
      ];

      const regions = {
        "ƒê·ªìng b·∫±ng s√¥ng H·ªìng": [
          "H√† N·ªôi",
          "Vƒ©nh Ph√∫c",
          "B·∫Øc Ninh",
          "Qu·∫£ng Ninh",
          "H·∫£i D∆∞∆°ng",
          "H·∫£i Ph√≤ng",
          "H∆∞ng Y√™n",
          "Th√°i B√¨nh",
          "H√† Nam",
          "Nam ƒê·ªãnh",
          "Ninh B√¨nh",
        ],
        "Trung du mi·ªÅn n√∫i ph√≠a B·∫Øc": [
          "H√† Giang",
          "Cao B·∫±ng",
          "B·∫Øc K·∫°n",
          "Tuy√™n Quang",
          "L√†o Cai",
          "Y√™n B√°i",
          "Th√°i Nguy√™n",
          "L·∫°ng S∆°n",
          "B·∫Øc Giang",
          "Ph√∫ Th·ªç",
          "ƒêi·ªán Bi√™n",
          "Lai Ch√¢u",
          "S∆°n La",
          "Ho√† B√¨nh",
        ],
        "Mi·ªÅn Trung": [
          "Thanh Ho√°",
          "Ngh·ªá An",
          "H√† Tƒ©nh",
          "Qu·∫£ng B√¨nh",
          "Qu·∫£ng Tr·ªã",
          "Th·ª´a Thi√™n Hu·∫ø",
          "ƒê√† N·∫µng",
          "Qu·∫£ng Nam",
          "Qu·∫£ng Ng√£i",
          "B√¨nh ƒê·ªãnh",
          "Ph√∫ Y√™n",
          "Kh√°nh Ho√†",
          "Ninh Thu·∫≠n",
          "B√¨nh Thu·∫≠n",
        ],
        "T√¢y Nguy√™n": ["Kon Tum", "Gia Lai", "ƒê·∫Øk L·∫Øk", "ƒê·∫Øk N√¥ng", "L√¢m ƒê·ªìng"],
        "ƒê√¥ng Nam B·ªô": [
          "B√¨nh Ph∆∞·ªõc",
          "T√¢y Ninh",
          "B√¨nh D∆∞∆°ng",
          "ƒê·ªìng Nai",
          "B√† R·ªãa - V≈©ng T√†u",
          "TP.HCM",
        ],
        "ƒê·ªìng b·∫±ng s√¥ng C·ª≠u Long": [
          "Long An",
          "Ti·ªÅn Giang",
          "B·∫øn Tre",
          "Tr√† Vinh",
          "Vƒ©nh Long",
          "ƒê·ªìng Th√°p",
          "An Giang",
          "Ki√™n Giang",
          "C·∫ßn Th∆°",
          "H·∫≠u Giang",
          "S√≥c TrƒÉng",
          "B·∫°c Li√™u",
          "C√† Mau",
        ],
      };

      const allCities = [].concat(...Object.values(regions));
      const weatherDataInit = {};
      allCities.forEach((city) => {
        const randomType =
          weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
        weatherDataInit[city] = {
          city,
          temp: Math.floor(Math.random() * 35) + 5,
          humidity: Math.floor(Math.random() * 101),
          weather: randomType.weather,
          icon: randomType.icon,
        };
      });

      const mostFrequentWeather = (cities, data) => {
        const count = {};
        cities.forEach((city) => {
          const w = data[city].weather;
          count[w] = (count[w] || 0) + 1;
        });
        const maxCount = Math.max(...Object.values(count));
        const candidates = Object.keys(count).filter(
          (k) => count[k] === maxCount
        );
        const chosen =
          candidates[Math.floor(Math.random() * candidates.length)];
        const icon = data[cities.find((c) => data[c].weather === chosen)].icon;
        return icon + " " + chosen;
      };

      const RegionCard = ({
        regionName,
        cities,
        weatherData,
        setWeatherData,
      }) => {
        const [selectedCity, setSelectedCity] = useState("all");
        const handleChange = (e) => setSelectedCity(e.target.value);
        const handleRefresh = () => {
          const city =
            selectedCity === "all"
              ? cities[Math.floor(Math.random() * cities.length)]
              : selectedCity;
          setWeatherData((prev) => {
            const newData = { ...prev };
            const randomType =
              weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
            newData[city] = {
              ...newData[city],
              temp: Math.floor(Math.random() * 35) + 5,
              humidity: Math.floor(Math.random() * 101),
              weather: randomType.weather,
              icon: randomType.icon,
            };
            return newData;
          });
        };

        const displayData =
          selectedCity === "all"
            ? {
                label: "To√†n khu v·ª±c",
                temp: Math.round(
                  cities.reduce((sum, c) => sum + weatherData[c].temp, 0) /
                    cities.length
                ),
                humidity: Math.round(
                  cities.reduce((sum, c) => sum + weatherData[c].humidity, 0) /
                    cities.length
                ),
                weatherInfo: mostFrequentWeather(cities, weatherData),
              }
            : weatherData[selectedCity];

        return (
          <div className="card">
            <h2>{regionName}</h2>
            <select value={selectedCity} onChange={handleChange}>
              <option value="all">To√†n khu v·ª±c</option>
              {cities.map((city) => (
                <option key={city} value={city}>
                  {city}
                </option>
              ))}
            </select>
            <div className="emoji">
              {selectedCity === "all"
                ? displayData.weatherInfo.split(" ")[0]
                : displayData.icon}
            </div>
            <div className="info">
              <strong>
                {selectedCity === "all" ? displayData.label : displayData.city}
              </strong>
            </div>
            <div>Nhi·ªát ƒë·ªô: {displayData.temp}¬∞C</div>
            <div>ƒê·ªô ·∫©m: {displayData.humidity}%</div>
            <div>
              Th·ªùi ti·∫øt:{" "}
              {selectedCity === "all"
                ? displayData.weatherInfo.split(" ").slice(1).join(" ")
                : displayData.weather}
            </div>
            <button onClick={handleRefresh}>L√†m m·ªõi</button>
          </div>
        );
      };

      const App = () => {
        const [weatherData, setWeatherData] = useState(weatherDataInit);
        return (
          <>
            {Object.keys(regions).map((region) => (
              <RegionCard
                key={region}
                regionName={region}
                cities={regions[region]}
                weatherData={weatherData}
                setWeatherData={setWeatherData}
              />
            ))}
          </>
        );
      };

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
